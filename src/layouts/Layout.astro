---
export interface Props {

title: string;

}

export interface Props {

title: string;

}

const { title } = Astro.props;

import { Analytics } from '@vercel/analytics/react';
import Chat from '../components/Chat.astro';
import TopBar from '../components/TopBar.astro';
import '../styles/global.css';

import  SpeedInsights  from "@vercel/speed-insights/astro"
---

<!doctype html>
<html lang="en">
	<head>
<!-- <script src="https://cdn.userway.org/widget.js" data-account="PWheC52pEa"></script> -->
<link rel="icon" href="/favicon.ico" />

<!-- Google tag (gtag.js) 
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XFMW8LR39F"></script>
<script>
  //@ts-ignore
  window.dataLayer = window.dataLayer || [];
  //@ts-ignore
  function gtag(){dataLayer.push(arguments);}
  //@ts-ignore
  gtag('js', new Date());

  //@ts-ignore
  gtag('config', 'G-XFMW8LR39F');
</script>
-->

<script>
//f ('serviceWorker' in navigator) {
//   window.addEventListener('load', function() {
//       navigator.serviceWorker.register('/sw.js').then(function(registration) {
//           console.log("Registered service worker with scope: ", registration.scope);
//       }, function(error) {
//           console.log("Service worker registration failed: ", error);
//       });
//   });
//
</script>
		<meta name="description" content="ElliNet13.com is a site made by ElliNet13." />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>{title}</title>
		<script>
			async function subscribeToPush() {
			  if (!('serviceWorker' in navigator) || !('PushManager' in window)) {
			    console.error("Push not supported");
			    return;
			  }
		  
			  try {
			    console.log("Registering SW...");
			    const registration = await navigator.serviceWorker.register('/sw.js', { scope: '/' });
			    console.log("SW registration:", registration);
			
			    // Wait until it's active
			    const activeRegistration = await navigator.serviceWorker.ready;
			    console.log("SW is active:", activeRegistration);
			
			    console.log("Subscribing to push...");
			    const subscription = await activeRegistration.pushManager.subscribe({
			      userVisibleOnly: true,
			      applicationServerKey: urlBase64ToUint8Array(
			        'BOOhQ5YW2LjBoyu1tlrY8u9DERJ_VmdD5KAtORjryp8zeMHndE2-dm42g7B5DmxexGw8s8CD6adcChBDw9VcsGE'
			      )
			    });
			
			    console.log("Subscription successful:", subscription);
			
			    await fetch('/api/save-subscription', {
			      method: 'POST',
			      body: JSON.stringify(subscription),
			      headers: { 'Content-Type': 'application/json' }
			    });
			
			  } catch (err) {
			    console.error("Push subscription failed:", err);
			  }
			}

			function urlBase64ToUint8Array(base64String: string) {
			  const padding = '='.repeat((4 - base64String.length % 4) % 4);
			  const base64 = (base64String + padding).replace(/\-/g, '+').replace(/_/g, '/');
			  const rawData = window.atob(base64);
			  return new Uint8Array([...rawData].map(c => c.charCodeAt(0)));
			}
			
			subscribeToPush();
		</script>
	</head>
	<body>
		<Analytics/>
		<!-- @ts-ignore -->
		<SpeedInsights/>
		<TopBar />
		<slot />
		<Chat/>
	</body>
</html>
<!-- @ts-ignore -->
<style is:global>
	:root {
		--accent: 255, 0, 0; /* Red color */
		--accent-light: 255, 204, 204; /* Light red color */
		--accent-dark: 139, 0, 0; /* Dark red color */
		--accent-gradient: linear-gradient(
			45deg,
			rgb(var(--accent)),
			rgb(var(--accent-light)) 30%,
			white 60%
		);
	}
	html {
		font-family: system-ui, sans-serif;
		background: #000000;
		background-size: 224px;
	}

</style>
